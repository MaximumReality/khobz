<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Victory Certificate</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&amp;family=Cormorant+Garamond:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100%) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    @keyframes confetti-explode {
      0% {
        transform: translate(0, 0) scale(0);
        opacity: 1;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }
    
    @keyframes shimmer {
      0%, 100% {
        background-position: -200% center;
      }
      50% {
        background-position: 200% center;
      }
    }
    
    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.4), 0 0 60px rgba(255, 215, 0, 0.2);
      }
      50% {
        box-shadow: 0 0 50px rgba(255, 215, 0, 0.6), 0 0 100px rgba(255, 215, 0, 0.3);
      }
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    
    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
    }
    
    .confetti-piece {
      position: absolute;
      width: 12px;
      height: 12px;
    }
    
    .certificate-wrapper {
      perspective: 1000px;
      transform-style: preserve-3d;
    }
    
    .certificate {
      transition: transform 0.1s ease-out;
      transform-style: preserve-3d;
      animation: pulse-glow 3s ease-in-out infinite;
    }
    
    .gold-border {
      background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
      background-size: 400% 400%;
      animation: shimmer 4s ease infinite;
    }
    
    .trophy-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .title-font {
      font-family: 'Cinzel Decorative', serif;
    }
    
    .body-font {
      font-family: 'Cormorant Garamond', serif;
    }
    
    .name-input {
      background: transparent;
      border: none;
      border-bottom: 3px dashed #b38728;
      outline: none;
      text-align: center;
      font-family: 'Cormorant Garamond', serif;
      transition: all 0.3s ease;
    }
    
    .name-input:focus {
      border-bottom-style: solid;
      border-bottom-color: #fcf6ba;
    }
    
    .name-input::placeholder {
      color: #8b7355;
      font-style: italic;
    }
    
    .seal {
      background: radial-gradient(circle, #d4af37 0%, #b8860b 50%, #8b6914 100%);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3), inset 0 2px 10px rgba(255,255,255,0.3);
    }
    
    .ribbon {
      clip-path: polygon(0 0, 100% 0, 100% 70%, 50% 100%, 0 70%);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto" style="background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f1a 100%);"><!-- Confetti Container -->
   <div id="confetti-container"></div><!-- Main Content -->
   <div class="min-h-full w-full flex items-center justify-center p-8">
    <div class="certificate-wrapper"><!-- Certificate -->
     <div id="certificate" class="certificate gold-border p-2 rounded-lg max-w-2xl">
      <div class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-lg p-8 md:p-12 relative overflow-hidden"><!-- Decorative corners -->
       <div class="absolute top-4 left-4 w-16 h-16 border-t-4 border-l-4 border-amber-400 rounded-tl-lg"></div>
       <div class="absolute top-4 right-4 w-16 h-16 border-t-4 border-r-4 border-amber-400 rounded-tr-lg"></div>
       <div class="absolute bottom-4 left-4 w-16 h-16 border-b-4 border-l-4 border-amber-400 rounded-bl-lg"></div>
       <div class="absolute bottom-4 right-4 w-16 h-16 border-b-4 border-r-4 border-amber-400 rounded-br-lg"></div><!-- Trophy -->
       <div class="trophy-float text-center mb-4"><span class="text-6xl md:text-7xl">üèÜ</span>
       </div><!-- Title -->
       <h1 id="cert-title" class="title-font text-3xl md:text-4xl text-center mb-2" style="background: linear-gradient(135deg, #fcf6ba, #d4af37, #fcf6ba); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Certificate of Achievement</h1><!-- Subtitle ribbon -->
       <div class="flex justify-center mb-6">
        <div class="ribbon bg-gradient-to-r from-red-700 via-red-600 to-red-700 px-8 py-2"><span class="body-font text-amber-100 font-semibold tracking-widest text-sm uppercase">Boss Defeated</span>
        </div>
       </div><!-- Body text -->
       <p class="body-font text-amber-100 text-xl md:text-2xl text-center mb-2">This hereby certifies that</p><!-- Name Input -->
       <div class="flex justify-center mb-4"><input type="text" id="winner-name" class="name-input text-3xl md:text-4xl font-bold text-amber-300 w-full max-w-md py-2" placeholder="Enter Your Name" maxlength="30">
       </div><!-- Achievement text -->
       <p class="body-font text-amber-100 text-lg md:text-xl text-center mb-2">has demonstrated exceptional skill and cunning in</p>
       <p id="achievement-text" class="body-font text-2xl md:text-3xl text-center font-bold mb-2" style="background: linear-gradient(135deg, #fcf6ba, #d4af37); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Defeating the Boss Level</p>
       <p class="body-font text-amber-100 text-lg md:text-xl text-center mb-6">in the legendary game</p><!-- Game name -->
       <h2 id="game-name" class="title-font text-2xl md:text-3xl text-center mb-8" style="background: linear-gradient(135deg, #ff6b6b, #ffd93d, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Bureaucracy Heist</h2><!-- Seal and date -->
       <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="flex flex-col items-center">
         <div class="seal w-20 h-20 rounded-full flex items-center justify-center"><span class="text-3xl">‚≠ê</span>
         </div>
         <p class="body-font text-amber-400 text-sm mt-2 italic">Official Seal</p>
        </div>
        <div class="text-center">
         <p class="body-font text-amber-100 text-lg" id="date-display"><!-- Date will be inserted here --></p>
         <div class="w-48 h-0.5 bg-gradient-to-r from-transparent via-amber-500 to-transparent mt-2"></div>
         <p class="body-font text-amber-400 text-sm mt-1 italic">Date of Victory</p>
        </div>
        <div class="flex flex-col items-center">
         <div class="text-4xl mb-1">
          üéÆ
         </div>
         <p class="body-font text-amber-400 text-sm italic">Game Master</p>
        </div>
       </div><!-- Decorative stars -->
       <div class="absolute top-1/2 left-2 transform -translate-y-1/2 opacity-30"><span class="text-2xl text-amber-400">‚ú¶</span>
       </div>
       <div class="absolute top-1/2 right-2 transform -translate-y-1/2 opacity-30"><span class="text-2xl text-amber-400">‚ú¶</span>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Celebration Button -->
   <div class="fixed bottom-6 right-6 z-50"><button id="celebrate-btn" class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-400 hover:to-amber-500 text-slate-900 font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-200 body-font text-lg"> üéâ Celebrate! </button>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      certificate_title: 'Certificate of Achievement',
      game_name: 'Bureaucracy Heist',
      achievement_text: 'Defeating the Boss Level',
      background_color: '#0f0f1a',
      gold_color: '#d4af37',
      text_color: '#fef3c7',
      accent_color: '#dc2626',
      button_color: '#f59e0b'
    };
    
    let config = { ...defaultConfig };
    let currentWinnerData = null;
    
    // Confetti system
    const confettiColors = ['#ff6b6b', '#ffd93d', '#6bcb77', '#4d96ff', '#ff6bcb', '#fcf6ba', '#d4af37', '#ffffff'];
    const confettiShapes = ['‚ñ†', '‚óè', '‚ñ≤', '‚òÖ', '‚ô¶', '‚óè'];
    
    function createConfettiPiece(x, y, isExplosion = false) {
      const piece = document.createElement('div');
      piece.className = 'confetti-piece';
      piece.style.left = x + 'px';
      piece.style.top = y + 'px';
      piece.style.color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
      piece.style.fontSize = (Math.random() * 15 + 8) + 'px';
      piece.textContent = confettiShapes[Math.floor(Math.random() * confettiShapes.length)];
      
      if (isExplosion) {
        const angle = Math.random() * Math.PI * 2;
        const distance = Math.random() * 400 + 200;
        const endX = Math.cos(angle) * distance;
        const endY = Math.sin(angle) * distance;
        const duration = Math.random() * 1.5 + 1;
        
        piece.style.animation = `confetti-explode ${duration}s ease-out forwards`;
        piece.style.setProperty('--end-x', endX + 'px');
        piece.style.setProperty('--end-y', endY + 'px');
        
        piece.animate([
          { transform: 'translate(0, 0) scale(0) rotate(0deg)', opacity: 1 },
          { transform: `translate(${endX}px, ${endY}px) scale(1) rotate(${Math.random() * 720}deg)`, opacity: 0 }
        ], {
          duration: duration * 1000,
          easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
          fill: 'forwards'
        });
      } else {
        const duration = Math.random() * 3 + 2;
        const drift = (Math.random() - 0.5) * 200;
        
        piece.animate([
          { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
          { transform: `translateY(100vh) translateX(${drift}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
        ], {
          duration: duration * 1000,
          easing: 'linear',
          fill: 'forwards'
        });
      }
      
      return piece;
    }
    
    function explodeConfetti(centerX, centerY, count = 100) {
      const container = document.getElementById('confetti-container');
      const wrapper = document.createElement('div');
      wrapper.className = 'confetti';
      wrapper.style.left = '0';
      wrapper.style.top = '0';
      
      for (let i = 0; i < count; i++) {
        const piece = createConfettiPiece(centerX, centerY, true);
        wrapper.appendChild(piece);
      }
      
      container.appendChild(wrapper);
      setTimeout(() => wrapper.remove(), 3000);
    }
    
    function rainConfetti(count = 150) {
      const container = document.getElementById('confetti-container');
      const wrapper = document.createElement('div');
      wrapper.className = 'confetti';
      wrapper.style.left = '0';
      wrapper.style.top = '0';
      
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const x = Math.random() * window.innerWidth;
          const piece = createConfettiPiece(x, -20, false);
          wrapper.appendChild(piece);
        }, Math.random() * 2000);
      }
      
      container.appendChild(wrapper);
      setTimeout(() => wrapper.remove(), 6000);
    }
    
    function massiveCelebration() {
      // Multiple explosion points
      const points = [
        { x: window.innerWidth * 0.2, y: window.innerHeight * 0.3 },
        { x: window.innerWidth * 0.8, y: window.innerHeight * 0.3 },
        { x: window.innerWidth * 0.5, y: window.innerHeight * 0.2 },
        { x: window.innerWidth * 0.3, y: window.innerHeight * 0.7 },
        { x: window.innerWidth * 0.7, y: window.innerHeight * 0.7 },
        { x: window.innerWidth * 0.5, y: window.innerHeight * 0.5 }
      ];
      
      points.forEach((point, i) => {
        setTimeout(() => explodeConfetti(point.x, point.y, 80), i * 150);
      });
      
      // Rain effect
      setTimeout(() => rainConfetti(200), 500);
      setTimeout(() => rainConfetti(150), 1500);
    }
    
    // Initial celebration on load
    setTimeout(() => {
      massiveCelebration();
    }, 500);
    
    // Tilt effect
    const certificate = document.getElementById('certificate');
    const wrapper = document.querySelector('.certificate-wrapper');
    
    wrapper.addEventListener('mousemove', (e) => {
      const rect = wrapper.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      
      const rotateX = (y - centerY) / 15;
      const rotateY = (centerX - x) / 15;
      
      certificate.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
    });
    
    wrapper.addEventListener('mouseleave', () => {
      certificate.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
    });
    
    // Celebrate button
    document.getElementById('celebrate-btn').addEventListener('click', () => {
      massiveCelebration();
    });
    
    // Set current date
    function updateDate() {
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('date-display').textContent = now.toLocaleDateString('en-US', options);
    }
    updateDate();
    
    // Data SDK handler for persistent winner name
    const dataHandler = {
      onDataChanged(data) {
        if (data && data.length > 0) {
          // Get the most recent winner entry
          currentWinnerData = data[data.length - 1];
          const nameInput = document.getElementById('winner-name');
          if (currentWinnerData.winner_name && nameInput.value !== currentWinnerData.winner_name) {
            nameInput.value = currentWinnerData.winner_name;
          }
        }
      }
    };
    
    // Name input handler with debounce
    let saveTimeout;
    const nameInput = document.getElementById('winner-name');
    
    nameInput.addEventListener('input', async (e) => {
      const name = e.target.value.trim();
      
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(async () => {
        if (name) {
          if (currentWinnerData) {
            // Update existing record
            const result = await window.dataSdk.update({
              ...currentWinnerData,
              winner_name: name
            });
            if (!result.isOk) {
              console.error('Failed to update winner name');
            }
          } else {
            // Create new record
            const result = await window.dataSdk.create({
              winner_name: name,
              completed_at: new Date().toISOString()
            });
            if (!result.isOk) {
              console.error('Failed to save winner name');
            }
          }
          
          // Trigger mini celebration on first name entry
          if (!currentWinnerData) {
            explodeConfetti(window.innerWidth / 2, window.innerHeight / 2, 50);
          }
        }
      }, 500);
    });
    
    // Focus celebration
    nameInput.addEventListener('focus', () => {
      const rect = nameInput.getBoundingClientRect();
      explodeConfetti(rect.left + rect.width / 2, rect.top, 30);
    });
    
    // Element SDK for config changes
    function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      document.getElementById('cert-title').textContent = config.certificate_title || defaultConfig.certificate_title;
      document.getElementById('game-name').textContent = config.game_name || defaultConfig.game_name;
      document.getElementById('achievement-text').textContent = config.achievement_text || defaultConfig.achievement_text;
    }
    
    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (value) => { cfg.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
          },
          {
            get: () => cfg.gold_color || defaultConfig.gold_color,
            set: (value) => { cfg.gold_color = value; window.elementSdk.setConfig({ gold_color: value }); }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (value) => { cfg.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
          },
          {
            get: () => cfg.accent_color || defaultConfig.accent_color,
            set: (value) => { cfg.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
          },
          {
            get: () => cfg.button_color || defaultConfig.button_color,
            set: (value) => { cfg.button_color = value; window.elementSdk.setConfig({ button_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(cfg) {
      return new Map([
        ['certificate_title', cfg.certificate_title || defaultConfig.certificate_title],
        ['game_name', cfg.game_name || defaultConfig.game_name],
        ['achievement_text', cfg.achievement_text || defaultConfig.achievement_text]
      ]);
    }
    
    // Initialize SDKs
    async function init() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
      
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
    }
    
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cb9143953140b12',t:'MTc3MDcwMDAwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
